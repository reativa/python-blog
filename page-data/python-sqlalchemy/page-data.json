{"componentChunkName":"component---src-templates-blog-post-js","path":"/python-sqlalchemy/","result":{"data":{"site":{"siteMetadata":{"title":"Python para impacientes"}},"markdownRemark":{"id":"c0e3f9b1-f0fb-57f3-ab9c-caa35734d088","excerpt":"Set a database URL output: Sqlalchemy Support DBAPI - PEP249 Transaction and Connect Object Metadata - Generating Database Schema Inspect - Get Database…","html":"<h1></h1>\n<h2>Set a database URL</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\npostgres_db <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n               <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n               <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n               <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n               <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>postgres_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nsqlite_db <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'sqlite'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'database'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'db.sqlite'</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>sqlite_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_url.py\npostgres://postgres:postgres@192.168.99.100:5432\nsqlite:///db.sqlite</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Sqlalchemy Support DBAPI - PEP249</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">\"sqlite:///db.sqlite\"</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># DBAPI - PEP249</span>\n<span class=\"token comment\"># create table</span>\nengine<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'CREATE TABLE \"EX1\" ('</span>\n               <span class=\"token string\">'id INTEGER NOT NULL,'</span>\n               <span class=\"token string\">'name VARCHAR, '</span>\n               <span class=\"token string\">'PRIMARY KEY (id));'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># insert a raw</span>\nengine<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'INSERT INTO \"EX1\" '</span>\n               <span class=\"token string\">'(id, name) '</span>\n               <span class=\"token string\">'VALUES (1,\"raw1\")'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># select *</span>\nresult <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'SELECT * FROM '</span>\n                        <span class=\"token string\">'\"EX1\"'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _r <span class=\"token keyword\">in</span> result<span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_r<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># delete *</span>\nengine<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'DELETE from \"EX1\" where id=1;'</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'SELECT * FROM \"EX1\"'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span>fetchall<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Transaction and Connect Object</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create connection</span>\nconn <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Begin transaction</span>\ntrans <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>begin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token string\">'INSERT INTO \"EX1\" (name) '</span>\n             <span class=\"token string\">'VALUES (\"Hello\")'</span><span class=\"token punctuation\">)</span>\ntrans<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Close connection</span>\nconn<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Metadata - Generating Database Schema</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create a metadata instance</span>\nmetadata <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Declare a table</span>\ntable <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'Example'</span><span class=\"token punctuation\">,</span>metadata<span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Create all tables</span>\nmetadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span>\n   <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Table: \"</span><span class=\"token punctuation\">,</span> _t<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Inspect - Get Database Information</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get table information</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get column information</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>inspector<span class=\"token punctuation\">.</span>get_columns<span class=\"token punctuation\">(</span><span class=\"token string\">'EX1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Reflection - Loading Table from Existing Database</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create a MetaData instance</span>\nmetadata <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># reflect db schema to MetaData</span>\nmetadata<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Get Table from MetaData</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Create MetaData instance</span>\nmetadata <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get Table</span>\nex_table <span class=\"token operator\">=</span> metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">[</span><span class=\"token string\">'Example'</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>ex_table<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Create all Tables Store in “MetaData”</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Register t1, t2 to metadata</span>\nt1 <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'EX1'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nt2 <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'EX2'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span>Integer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Create all tables in meta</span>\nmeta<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Create Specific Table</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\nt1 <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table_1'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nt2 <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table_2'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n           Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span>Integer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nt1<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Create table with same columns</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    inspect<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token string\">\"sqlite://\"</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TemplateTable</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token builtin\">id</span>   <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    age  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DowntownAPeople</span><span class=\"token punctuation\">(</span>TemplateTable<span class=\"token punctuation\">,</span> Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"downtown_a_people\"</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DowntownBPeople</span><span class=\"token punctuation\">(</span>TemplateTable<span class=\"token punctuation\">,</span> Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"downtown_b_people\"</span>\n\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># check table exists</span>\nins <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> ins<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Drop a Table</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nm <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'Test'</span><span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ntable<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Test'</span> <span class=\"token keyword\">in</span> inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ntable<span class=\"token punctuation\">.</span>drop<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Test'</span> <span class=\"token keyword\">in</span> inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_drop.py\n$ True\n$ False</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Some Table Object Operation</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nt <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'ex_table'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n          Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          Column<span class=\"token punctuation\">(</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Get Table Name</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get Columns</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>columns<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get Column</span>\nc <span class=\"token operator\">=</span> t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>key\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Or</span>\nc <span class=\"token operator\">=</span> t<span class=\"token punctuation\">.</span>columns<span class=\"token punctuation\">.</span>key\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Get Table from Column</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">.</span>table<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>SQL Expression Language</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token comment\"># Think Column as \"ColumnElement\"</span>\n<span class=\"token comment\"># Implement via overwrite special function</span>\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> or_\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'example'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'l_name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n              Column<span class=\"token punctuation\">(</span><span class=\"token string\">'f_name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># sql expression binary object</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">repr</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'ed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># exhbit sql expression</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'ed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">repr</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>f_name <span class=\"token operator\">!=</span> <span class=\"token string\">'ed'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># comparison operator</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">repr</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">></span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># or expression</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Equal to</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>or_<span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">></span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># compare to None produce IS NULL</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Equal to</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name<span class=\"token punctuation\">.</span>is_<span class=\"token punctuation\">(</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># + means \"addition\"</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># or means \"string concatenation\"</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">+</span> <span class=\"token string\">\"some name\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># in expression</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name<span class=\"token punctuation\">.</span>in_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>insert() - Create an “INSERT” Statement</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> String\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create table</span>\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n   Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n   Column<span class=\"token punctuation\">(</span><span class=\"token string\">'l_name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n   Column<span class=\"token punctuation\">(</span><span class=\"token string\">'f_name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmeta<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># insert data via insert() construct</span>\nins <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">(</span>\n      l_name<span class=\"token operator\">=</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span>\n      f_name<span class=\"token operator\">=</span><span class=\"token string\">'World'</span><span class=\"token punctuation\">)</span>\nconn <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>ins<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># insert multiple data</span>\nconn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>\n   <span class=\"token punctuation\">{</span><span class=\"token string\">'l_name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'f_name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'bob'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">{</span><span class=\"token string\">'l_name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'yo'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'f_name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'alice'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>select() - Create a “SELECT” Statement</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> select\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> or_\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\nconn <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> meta<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># select * from 'user'</span>\nselect_st <span class=\"token operator\">=</span> select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>table<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>\n   table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>select_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># or equal to</span>\nselect_st <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>\n   table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>select_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># combine with \"OR\"</span>\nselect_st <span class=\"token operator\">=</span> select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n   table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name<span class=\"token punctuation\">,</span>\n   table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>f_name<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>or_<span class=\"token punctuation\">(</span>\n      table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span>\n      table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>select_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># combine with \"ORDER_BY\"</span>\nselect_st <span class=\"token operator\">=</span> select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>table<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>or_<span class=\"token punctuation\">(</span>\n      table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span>\n      table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hi'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>f_name<span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>select_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>join() - Joined Two Tables via “JOIN” Statement</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> String\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> select\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nemail_t <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'email_addr'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nmeta<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># get user table</span>\nuser_t <span class=\"token operator\">=</span> meta<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># insert</span>\nconn <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nconn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>email_t<span class=\"token punctuation\">.</span>insert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>\n   <span class=\"token punctuation\">{</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'ker@test'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Hi'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">{</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'yo@test'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># join statement</span>\njoin_obj <span class=\"token operator\">=</span> user_t<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>email_t<span class=\"token punctuation\">,</span>\n           email_t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> user_t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name<span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># using select_from</span>\nsel_st <span class=\"token operator\">=</span> select<span class=\"token punctuation\">(</span>\n   <span class=\"token punctuation\">[</span>user_t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name<span class=\"token punctuation\">,</span> email_t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>select_from<span class=\"token punctuation\">(</span>join_obj<span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>sel_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Delete Rows from Table</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\nconn <span class=\"token operator\">=</span> engine<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nuser_t <span class=\"token operator\">=</span> meta<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># select * from user_t</span>\nsel_st <span class=\"token operator\">=</span> user_t<span class=\"token punctuation\">.</span>select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>sel_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># delete l_name == 'Hello'</span>\ndel_st <span class=\"token operator\">=</span> user_t<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>\n      user_t<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>l_name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'----- delete -----'</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>del_st<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># check rows has been delete</span>\nsel_st <span class=\"token operator\">=</span> user_t<span class=\"token punctuation\">.</span>select<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nres <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span>sel_st<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> res<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Check Table Existing</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\nModal <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Example</span><span class=\"token punctuation\">(</span>Modal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"ex_t\"</span>\n   <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n   name <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ndb_uri <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite:///db.sqlite'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_uri<span class=\"token punctuation\">)</span>\nModal<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># check register table exist to Modal</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> Modal<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># check all table in database</span>\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> meta<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># check table names exists via inspect</span>\nins <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> ins<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Create multiple tables at once</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> Integer\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n\nurl <span class=\"token operator\">=</span> URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db<span class=\"token punctuation\">)</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n\nmetadata <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nmetadata<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_table</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    tables <span class=\"token operator\">=</span> metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> name <span class=\"token keyword\">not</span> <span class=\"token keyword\">in</span> tables<span class=\"token punctuation\">:</span>\n        table <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span>\n                      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                      Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        table<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\ntables <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'table1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'table2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'table3'</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> tables<span class=\"token punctuation\">:</span> create_table<span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">)</span>\n\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_create.py\n<span class=\"token punctuation\">[</span>u<span class=\"token string\">'table1'</span>, u<span class=\"token string\">'table2'</span>, u<span class=\"token string\">'table3'</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Create tables with dynamic columns (Table)</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Table\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> MetaData\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_table</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>cols<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    meta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    meta<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> name <span class=\"token keyword\">in</span> meta<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span>\n\n    table <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>cols<span class=\"token punctuation\">)</span>\n    table<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\ncreate_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table1'</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ncreate_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table2'</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'key'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'val'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_dynamic.py\nTable1\nTable2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational add data</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> DateTime\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>exc <span class=\"token keyword\">import</span> SQLAlchemyError\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestTable</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'Test Table'</span>\n    <span class=\"token builtin\">id</span>   <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    key  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    val  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    date <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>DateTime<span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create tables</span>\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\ndata <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5566</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9527</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'c'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">183</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> _key<span class=\"token punctuation\">,</span> _val <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        row <span class=\"token operator\">=</span> TestTable<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span>_key<span class=\"token punctuation\">,</span> val<span class=\"token operator\">=</span>_val<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\n    session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> SQLAlchemyError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational update data</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> DateTime\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>exc <span class=\"token keyword\">import</span> SQLAlchemyError\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestTable</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'Test Table'</span>\n    <span class=\"token builtin\">id</span>   <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    key  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    val  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    date <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>DateTime<span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create tables</span>\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># add row to database</span>\n    row <span class=\"token operator\">=</span> TestTable<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> val<span class=\"token operator\">=</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">)</span>\n    session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\n    session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># update row to database</span>\n    row <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>TestTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n          TestTable<span class=\"token punctuation\">.</span>key <span class=\"token operator\">==</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'original:'</span><span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">)</span>\n    row<span class=\"token punctuation\">.</span>key <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello\"</span>\n    row<span class=\"token punctuation\">.</span>val <span class=\"token operator\">=</span> <span class=\"token string\">\"World\"</span>\n    session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># check update correct</span>\n    row <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>TestTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n          TestTable<span class=\"token punctuation\">.</span>key <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'update:'</span><span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> SQLAlchemyError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_update.py\noriginal: hello world\nupdate: Hello World</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational delete row</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> DateTime\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>exc <span class=\"token keyword\">import</span> SQLAlchemyError\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TestTable</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'Test Table'</span>\n    <span class=\"token builtin\">id</span>   <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    key  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    val  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    date <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>DateTime<span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">.</span>utcnow<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create tables</span>\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nrow <span class=\"token operator\">=</span> TestTable<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">,</span> val<span class=\"token operator\">=</span><span class=\"token string\">'world'</span><span class=\"token punctuation\">)</span>\nsession<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>TestTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n        TestTable<span class=\"token punctuation\">.</span>key<span class=\"token operator\">==</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nquery<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>TestTable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n        TestTable<span class=\"token punctuation\">.</span>key<span class=\"token operator\">==</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_delete.py\n<span class=\"token operator\">&lt;</span>__main__.TestTable object at 0x104eb8f5<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span>\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational relationship</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> ForeignKey\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> relationship\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'user'</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    addresses <span class=\"token operator\">=</span> relationship<span class=\"token punctuation\">(</span><span class=\"token string\">\"Address\"</span><span class=\"token punctuation\">,</span> backref<span class=\"token operator\">=</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'address'</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    email <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    user_id <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'user.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nu1 <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\na1 <span class=\"token operator\">=</span> Address<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>u1<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a1<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span>\n\nu1<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>a1<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>u1<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>a1<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_relationship.py\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nNone\n<span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>__main__.Address object at 0x10c4edb5<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span><span class=\"token punctuation\">]</span>\n<span class=\"token operator\">&lt;</span>__main__.User object at 0x10c4ed81<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational self association</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    Column<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    ForeignKey<span class=\"token punctuation\">,</span>\n    Table<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    sessionmaker<span class=\"token punctuation\">,</span>\n    relationship<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\nbase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nassociation <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">\"Association\"</span><span class=\"token punctuation\">,</span> base<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">(</span><span class=\"token string\">'left'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'node.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">(</span><span class=\"token string\">'right'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'node.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'node'</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    label <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    friends <span class=\"token operator\">=</span> relationship<span class=\"token punctuation\">(</span><span class=\"token string\">'Node'</span><span class=\"token punctuation\">,</span>\n                           secondary<span class=\"token operator\">=</span>association<span class=\"token punctuation\">,</span>\n                           primaryjoin<span class=\"token operator\">=</span><span class=\"token builtin\">id</span><span class=\"token operator\">==</span>association<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">,</span>\n                           secondaryjoin<span class=\"token operator\">=</span><span class=\"token builtin\">id</span><span class=\"token operator\">==</span>association<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>right<span class=\"token punctuation\">,</span>\n                           backref<span class=\"token operator\">=</span><span class=\"token string\">'left'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">to_json</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">id</span><span class=\"token operator\">=</span>self<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">,</span>\n                    friends<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>_<span class=\"token punctuation\">.</span>label <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> self<span class=\"token punctuation\">.</span>friends<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nnodes <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Node<span class=\"token punctuation\">(</span>label<span class=\"token operator\">=</span><span class=\"token string\">'node_{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nnodes<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>friends<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>nodes<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> nodes<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nnodes<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>friends<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>nodes<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'----> right'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>_<span class=\"token punctuation\">.</span>to_json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> nodes<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> indent<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'----> left'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>_n<span class=\"token punctuation\">.</span>to_json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _n <span class=\"token keyword\">in</span> nodes<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> indent<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">----<span class=\"token operator\">></span> right\n<span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"friends\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"node_1\"</span>,\n      <span class=\"token string\">\"node_2\"</span>\n    <span class=\"token punctuation\">]</span>,\n    <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> null\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"friends\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"node_2\"</span>\n    <span class=\"token punctuation\">]</span>,\n    <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> null\n  <span class=\"token punctuation\">}</span>,\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"friends\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>,\n    <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> null\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n----<span class=\"token operator\">></span> left\n<span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"friends\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"node_1\"</span>,\n      <span class=\"token string\">\"node_2\"</span>\n    <span class=\"token punctuation\">]</span>,\n    <span class=\"token string\">\"id\"</span><span class=\"token builtin class-name\">:</span> null\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational basic query</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> DateTime\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> or_\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> desc\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>exc <span class=\"token keyword\">import</span> SQLAlchemyError\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'User'</span>\n    <span class=\"token builtin\">id</span>       <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name     <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    fullname <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">,</span> nullable<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n    birth    <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>DateTime<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create tables</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\nusers <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'ed'</span><span class=\"token punctuation\">,</span>\n         fullname<span class=\"token operator\">=</span><span class=\"token string\">'Ed Jones'</span><span class=\"token punctuation\">,</span>\n         birth<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">1989</span><span class=\"token punctuation\">,</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'wendy'</span><span class=\"token punctuation\">,</span>\n         fullname<span class=\"token operator\">=</span><span class=\"token string\">'Wendy Williams'</span><span class=\"token punctuation\">,</span>\n         birth<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">1983</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'mary'</span><span class=\"token punctuation\">,</span>\n         fullname<span class=\"token operator\">=</span><span class=\"token string\">'Mary Contrary'</span><span class=\"token punctuation\">,</span>\n         birth<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">1990</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'fred'</span><span class=\"token punctuation\">,</span>\n         fullname<span class=\"token operator\">=</span><span class=\"token string\">'Fred Flinstone'</span><span class=\"token punctuation\">,</span>\n         birth<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">1977</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">12</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'justin'</span><span class=\"token punctuation\">,</span>\n         fullname<span class=\"token operator\">=</span><span class=\"token string\">\"Justin Bieber\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># add_all</span>\nsession<span class=\"token punctuation\">.</span>add_all<span class=\"token punctuation\">(</span>users<span class=\"token punctuation\">)</span>\nsession<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"----> order_by(id):\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> order_by(desc(id)):\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span>desc<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> order_by(date):\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>order_by<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> EQUAL:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n_row <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> NOT EQUAL:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span> <span class=\"token operator\">!=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> IN:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>in_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ed'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'wendy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> NOT IN:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span><span class=\"token operator\">~</span>User<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>in_<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'ed'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'wendy'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> AND:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n        User<span class=\"token punctuation\">.</span>name<span class=\"token operator\">==</span><span class=\"token string\">'ed'</span><span class=\"token punctuation\">,</span> User<span class=\"token punctuation\">.</span>fullname<span class=\"token operator\">==</span><span class=\"token string\">'Ed Jones'</span><span class=\"token punctuation\">)</span>\n_row <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> OR:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>\n        or_<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>name<span class=\"token operator\">==</span><span class=\"token string\">'ed'</span><span class=\"token punctuation\">,</span> User<span class=\"token punctuation\">.</span>name<span class=\"token operator\">==</span><span class=\"token string\">'wendy'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>birth<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> NULL:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>birth <span class=\"token operator\">==</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> NOT NULL:\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>birth <span class=\"token operator\">!=</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n----> LIKE\"</span><span class=\"token punctuation\">)</span>\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">.</span>like<span class=\"token punctuation\">(</span><span class=\"token string\">'%ed%'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _row <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_row<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _row<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">----<span class=\"token operator\">></span> order_by<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span>:\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\nmary Mary Contrary <span class=\"token number\">1990</span>-01-30 00:00:00\nfred Fred Flinstone <span class=\"token number\">1977</span>-03-12 00:00:00\njustin Justin Bieber None\n\n----<span class=\"token operator\">></span> order_by<span class=\"token punctuation\">(</span>desc<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">))</span>:\njustin Justin Bieber None\nfred Fred Flinstone <span class=\"token number\">1977</span>-03-12 00:00:00\nmary Mary Contrary <span class=\"token number\">1990</span>-01-30 00:00:00\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\n\n----<span class=\"token operator\">></span> order_by<span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span>:\nfred Fred Flinstone <span class=\"token number\">1977</span>-03-12 00:00:00\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\nmary Mary Contrary <span class=\"token number\">1990</span>-01-30 00:00:00\njustin Justin Bieber None\n\n----<span class=\"token operator\">></span> EQUAL:\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\n\n----<span class=\"token operator\">></span> NOT EQUAL:\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\nmary Mary Contrary <span class=\"token number\">1990</span>-01-30 00:00:00\nfred Fred Flinstone <span class=\"token number\">1977</span>-03-12 00:00:00\njustin Justin Bieber None\n\n----<span class=\"token operator\">></span> IN:\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\n\n----<span class=\"token operator\">></span> NOT IN:\nmary Mary Contrary <span class=\"token number\">1990</span>-01-30 00:00:00\nfred Fred Flinstone <span class=\"token number\">1977</span>-03-12 00:00:00\njustin Justin Bieber None\n\n----<span class=\"token operator\">></span> AND:\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\n\n----<span class=\"token operator\">></span> OR:\ned Ed Jones <span class=\"token number\">1989</span>-07-01 00:00:00\nwendy Wendy Williams <span class=\"token number\">1983</span>-04-01 00:00:00\n\n----<span class=\"token operator\">></span> NULL:\njustin Justin Bieber\n\n----<span class=\"token operator\">></span> NOT NULL:\ned Ed Jones\nwendy Wendy Williams\nmary Mary Contrary\nfred Fred Flinstone\n\n----<span class=\"token operator\">></span> LIKE\ned Ed Jones\nfred Fred Flinstone</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>mapper: Map <code class=\"language-text\">Table</code> to <code class=\"language-text\">class</code></h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    Table<span class=\"token punctuation\">,</span>\n    MetaData<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    ForeignKey<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    mapper<span class=\"token punctuation\">,</span>\n    relationship<span class=\"token punctuation\">,</span>\n    sessionmaker<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># classical mapping: map \"table\" to \"class\"</span>\ndb_url <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite://'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\n\nmeta <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\nuser <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'User'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'fullname'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'password'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\naddr <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token string\">'Address'</span><span class=\"token punctuation\">,</span> meta<span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'email'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             Column<span class=\"token punctuation\">(</span><span class=\"token string\">'user_id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'User.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># map table to class</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">,</span> fullname<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n        self<span class=\"token punctuation\">.</span>fullname <span class=\"token operator\">=</span> fullname\n        self<span class=\"token punctuation\">.</span>password <span class=\"token operator\">=</span> password\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> email<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>email <span class=\"token operator\">=</span> email\n\nmapper<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">,</span> properties<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n       <span class=\"token string\">'addresses'</span><span class=\"token punctuation\">:</span> relationship<span class=\"token punctuation\">(</span>Address<span class=\"token punctuation\">,</span> backref<span class=\"token operator\">=</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nmapper<span class=\"token punctuation\">(</span>Address<span class=\"token punctuation\">,</span> addr<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create table</span>\nmeta<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nu <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> fullname<span class=\"token operator\">=</span><span class=\"token string\">'HelloWorld'</span><span class=\"token punctuation\">,</span> password<span class=\"token operator\">=</span><span class=\"token string\">'ker'</span><span class=\"token punctuation\">)</span>\na <span class=\"token operator\">=</span> Address<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span><span class=\"token string\">'hello@hello.com'</span><span class=\"token punctuation\">)</span>\nu<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">)</span>\n    session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># query result</span>\n    u <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">filter</span><span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">.</span>name <span class=\"token operator\">==</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>first<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>u<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> u<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span> u<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python map_table_class.py\nHello HelloWorld ker</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h2>Get table dynamically</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    MetaData<span class=\"token punctuation\">,</span>\n    Table<span class=\"token punctuation\">,</span>\n    inspect<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    mapper<span class=\"token punctuation\">,</span>\n    scoped_session<span class=\"token punctuation\">,</span>\n    sessionmaker<span class=\"token punctuation\">)</span>\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token string\">\"sqlite://\"</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\nmetadata <span class=\"token operator\">=</span> MetaData<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TableTemp</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">object</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        self<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_table</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> name <span class=\"token keyword\">in</span> metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span>\n        table <span class=\"token operator\">=</span> metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">[</span>name<span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        table <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">,</span>\n                Column<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                Column<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        table<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n\n    cls <span class=\"token operator\">=</span> <span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>TableTemp<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    mapper<span class=\"token punctuation\">(</span>cls<span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> cls\n\n<span class=\"token comment\"># get table first times</span>\nt <span class=\"token operator\">=</span> get_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># get table secone times</span>\nt <span class=\"token operator\">=</span> get_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Hello'</span><span class=\"token punctuation\">)</span>\n\nSession <span class=\"token operator\">=</span> scoped_session<span class=\"token punctuation\">(</span>sessionmaker<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    Session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    Session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> Session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    Session<span class=\"token punctuation\">.</span>rollback<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    Session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python get_table.py\nfoo\nbar</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Object Relational join two tables</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String<span class=\"token punctuation\">,</span> ForeignKey\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> relationship\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'user'</span>\n    <span class=\"token builtin\">id</span>    <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    addresses <span class=\"token operator\">=</span> relationship<span class=\"token punctuation\">(</span><span class=\"token string\">\"Address\"</span><span class=\"token punctuation\">,</span> backref<span class=\"token operator\">=</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Address</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'address'</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    email <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    user_id <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'user.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># create engine</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create tables</span>\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># create session</span>\nSession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nSession<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nuser <span class=\"token operator\">=</span> User<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">'user1'</span><span class=\"token punctuation\">)</span>\nmail1 <span class=\"token operator\">=</span> Address<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span><span class=\"token string\">'user1@foo.com'</span><span class=\"token punctuation\">)</span>\nmail2 <span class=\"token operator\">=</span> Address<span class=\"token punctuation\">(</span>email<span class=\"token operator\">=</span><span class=\"token string\">'user1@bar.com'</span><span class=\"token punctuation\">)</span>\nuser<span class=\"token punctuation\">.</span>addresses<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>mail1<span class=\"token punctuation\">,</span> mail2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nsession<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\nsession<span class=\"token punctuation\">.</span>add_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>mail1<span class=\"token punctuation\">,</span> mail2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\nsession<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nquery <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>Address<span class=\"token punctuation\">,</span> User<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>User<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _a<span class=\"token punctuation\">,</span> _u <span class=\"token keyword\">in</span> query<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_u<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _a<span class=\"token punctuation\">.</span>email<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_join.py\nuser1 user1@foo.com\nuser1 user1@bar.com</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>join on relationship and group_by count</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">,</span>\n    ForeignKey<span class=\"token punctuation\">,</span>\n    func<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    relationship<span class=\"token punctuation\">,</span>\n    sessionmaker<span class=\"token punctuation\">,</span>\n    scoped_session<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite://'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\n\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Parent</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'parent'</span>\n    <span class=\"token builtin\">id</span>       <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name     <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    children <span class=\"token operator\">=</span> relationship<span class=\"token punctuation\">(</span><span class=\"token string\">'Child'</span><span class=\"token punctuation\">,</span> back_populates<span class=\"token operator\">=</span><span class=\"token string\">'parent'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span><span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'child'</span>\n    <span class=\"token builtin\">id</span>        <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    name      <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    parent_id <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> ForeignKey<span class=\"token punctuation\">(</span><span class=\"token string\">'parent.id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    parent    <span class=\"token operator\">=</span> relationship<span class=\"token punctuation\">(</span><span class=\"token string\">'Parent'</span><span class=\"token punctuation\">,</span> back_populates<span class=\"token operator\">=</span><span class=\"token string\">'children'</span><span class=\"token punctuation\">)</span>\n\nBase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nSession <span class=\"token operator\">=</span> scoped_session<span class=\"token punctuation\">(</span>sessionmaker<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\np1 <span class=\"token operator\">=</span> Parent<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"Alice\"</span><span class=\"token punctuation\">)</span>\np2 <span class=\"token operator\">=</span> Parent<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"Bob\"</span><span class=\"token punctuation\">)</span>\n\nc1 <span class=\"token operator\">=</span> Child<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span>\nc2 <span class=\"token operator\">=</span> Child<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">)</span>\nc3 <span class=\"token operator\">=</span> Child<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"ker\"</span><span class=\"token punctuation\">)</span>\nc4 <span class=\"token operator\">=</span> Child<span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">)</span>\n\np1<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span>extend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>c1<span class=\"token punctuation\">,</span> c2<span class=\"token punctuation\">,</span> c3<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\np2<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>c4<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    Session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">)</span>\n    Session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>p2<span class=\"token punctuation\">)</span>\n    Session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># count number of children</span>\n    q <span class=\"token operator\">=</span> Session<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>Parent<span class=\"token punctuation\">,</span> func<span class=\"token punctuation\">.</span>count<span class=\"token punctuation\">(</span>Child<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\\\n               <span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>Child<span class=\"token punctuation\">)</span>\\\n               <span class=\"token punctuation\">.</span>group_by<span class=\"token punctuation\">(</span>Parent<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># print result</span>\n    <span class=\"token keyword\">for</span> _p<span class=\"token punctuation\">,</span> _c <span class=\"token keyword\">in</span> q<span class=\"token punctuation\">.</span><span class=\"token builtin\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'parent: {}, num_child: {}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>_p<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span> _c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    Session<span class=\"token punctuation\">.</span>remove<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python join_group_by.py\nparent: Alice, num_child: <span class=\"token number\">3</span>\nparent: Bob, num_child: <span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Create tables with dynamic columns (ORM)</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> Column<span class=\"token punctuation\">,</span> Integer<span class=\"token punctuation\">,</span> String\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>engine<span class=\"token punctuation\">.</span>url <span class=\"token keyword\">import</span> URL\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\ndb_url <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'drivername'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'password'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'postgres'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'host'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'192.168.99.100'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'port'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5432</span><span class=\"token punctuation\">}</span>\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>URL<span class=\"token punctuation\">(</span><span class=\"token operator\">**</span>db_url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nBase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">create_table</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> cols<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    Base<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>reflect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> name <span class=\"token keyword\">in</span> Base<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>tables<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span>\n\n    table <span class=\"token operator\">=</span> <span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>Base<span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> cols<span class=\"token punctuation\">)</span>\n    table<span class=\"token punctuation\">.</span>__table__<span class=\"token punctuation\">.</span>create<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n\ncreate_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table1'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n             <span class=\"token string\">'__tablename__'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Table1'</span><span class=\"token punctuation\">,</span>\n             <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\ncreate_table<span class=\"token punctuation\">(</span><span class=\"token string\">'Table2'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n             <span class=\"token string\">'__tablename__'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Table2'</span><span class=\"token punctuation\">,</span>\n             <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             <span class=\"token string\">'key'</span><span class=\"token punctuation\">:</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n             <span class=\"token string\">'val'</span><span class=\"token punctuation\">:</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\ninspector <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> _t <span class=\"token keyword\">in</span> inspector<span class=\"token punctuation\">.</span>get_table_names<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>_t<span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sqlalchemy_dynamic_orm.py\nTable1\nTable2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>Close database connection</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    event<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span><span class=\"token string\">'sqlite://'</span><span class=\"token punctuation\">)</span>\nbase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n@event<span class=\"token punctuation\">.</span>listens_for<span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">,</span> <span class=\"token string\">'engine_disposed'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">receive_engine_disposed</span><span class=\"token punctuation\">(</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"engine dispose\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Table</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'example table'</span>\n    <span class=\"token builtin\">id</span> <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\nbase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        row <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        session<span class=\"token punctuation\">.</span>rollback<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">raise</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    engine<span class=\"token punctuation\">.</span>dispose<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python db_dispose.py\nengine dispose</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"admonition warning\">\n<p>Be careful. Close <em>session</em> does not mean close database connection.\nSQLAlchemy <em>session</em> generally represents the <em>transactions</em>, not\nconnections.</p>\n</div>\n<h2>Cannot use the object after close the session</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-python line-numbers\"><code class=\"language-python\"><span class=\"token keyword\">from</span> __future__ <span class=\"token keyword\">import</span> print_function\n\n<span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span>\n    create_engine<span class=\"token punctuation\">,</span>\n    Column<span class=\"token punctuation\">,</span>\n    String<span class=\"token punctuation\">,</span>\n    Integer<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\n\n\nurl <span class=\"token operator\">=</span> <span class=\"token string\">'sqlite://'</span>\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\nbase <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Table</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">'table'</span>\n    <span class=\"token builtin\">id</span>  <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>Integer<span class=\"token punctuation\">,</span> primary_key<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n    key <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n    val <span class=\"token operator\">=</span> Column<span class=\"token punctuation\">(</span>String<span class=\"token punctuation\">)</span>\n\nbase<span class=\"token punctuation\">.</span>metadata<span class=\"token punctuation\">.</span>create_all<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\nsession <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>bind<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n    t <span class=\"token operator\">=</span> Table<span class=\"token punctuation\">(</span>key<span class=\"token operator\">=</span><span class=\"token string\">\"key\"</span><span class=\"token punctuation\">,</span> val<span class=\"token operator\">=</span><span class=\"token string\">\"val\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n        session<span class=\"token punctuation\">.</span>rollback<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span>key<span class=\"token punctuation\">,</span> t<span class=\"token punctuation\">.</span>val<span class=\"token punctuation\">)</span> <span class=\"token comment\"># exception raise from here</span>\n<span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cannot use the object after close the session\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\n    engine<span class=\"token punctuation\">.</span>dispose<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>output:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">$ python sql.py\nkey val\nCannot use the object after close the session</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p><a href=\"https://www.pythonsheets.com/\">Acesse a Referência original 1:</a>\n<a href=\"https://www.pythoncheatsheet.org/\">Acesse a Referência original 2:</a></p>","frontmatter":{"title":"Python tudo sobre SQLAlchemy","date":"January 05, 2020","description":""}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/python-sqlalchemy/","previous":{"fields":{"slug":"/python-asyncio/"},"frontmatter":{"title":"Python tudo sobre Asyncio"}},"next":{"fields":{"slug":"/python-typing/"},"frontmatter":{"title":"Python tudo sobre Typing"}}}}}